<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneaker Lace Matcher</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --sidebar-bg: #ffffff;
            --preview-bg: #f8f9fa;
            --accent-color: #4a90e2;
            --text-color: #333;
            --border-radius: 16px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .container {
            display: flex;
            width: 90%;
            max-width: 1000px;
            height: 85vh;
            max-height: 700px;
            background-color: var(--sidebar-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .sidebar {
            flex: 0 0 320px;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 2;
            box-shadow: 2px 0 10px rgba(0,0,0,0.03);
        }

        .sidebar h1 {
            font-size: 22px;
            margin: 0 0 8px 0;
            font-weight: 700;
        }

        .sidebar p.subtitle {
            font-size: 13px;
            color: #888;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        select {
            padding: 12px 15px;
            font-size: 14px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            background-color: #fff;
            width: 100%;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 14px;
        }

        select:focus { border-color: var(--accent-color); }
        select:disabled { background-color: #f5f5f5; color: #aaa; cursor: default; }

        .preview-area {
            flex: 1;
            background-color: var(--preview-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        img#shoeImage {
            max-width: 90%;
            max-height: 70%;
            width: auto;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15));
            display: none;
            transition: opacity 0.3s ease;
        }

        .placeholder-text {
            color: #adb5bd;
            font-size: 14px;
            text-align: center;
        }

        .info-bar {
            margin-top: 15px;
            text-align: center;
            min-height: 40px;
        }

        .stats { font-size: 13px; font-weight: 600; color: var(--accent-color); margin-bottom: 4px; }
        .url-info { font-size: 10px; color: #aaa; }

        @media (max-width: 768px) {
            body { height: auto; padding: 20px; overflow-y: auto; }
            .container { flex-direction: column; height: auto; max-height: none; }
            .sidebar { width: 100%; padding: 30px; flex: none; }
            .preview-area { min-height: 300px; padding: 40px 20px; }
            img#shoeImage { max-height: 300px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="sidebar">
            <h1>ðŸ‘Ÿ Lace Matcher</h1>
            <p class="subtitle">Select a brand and colors<br>to preview your custom style.</p>

            <div class="input-group">
                <select id="brand"><option value="">Select Brand</option></select>
                <select id="model" disabled><option value="">Select Model</option></select>
                <select id="color" disabled><option value="">Shoe Color</option></select>
                <select id="lace" disabled><option value="">Lace Color</option></select>
            </div>
        </div>

        <div class="preview-area">
            <span id="placeholderText" class="placeholder-text">Select options<br>to view preview.</span>
            <img id="shoeImage" alt="Shoe Preview">
            
            <div class="info-bar">
                <div id="loadTime" class="stats"></div>
                <div id="currentSrc" class="url-info"></div>
            </div>
        </div>
    </div>

    <script>
        const CDN_BASE_URL = ""; 

        const els = {
            brand: document.getElementById('brand'),
            model: document.getElementById('model'),
            color: document.getElementById('color'),
            lace: document.getElementById('lace'),
            img: document.getElementById('shoeImage'),
            time: document.getElementById('loadTime'),
            src: document.getElementById('currentSrc'),
            placeholder: document.getElementById('placeholderText')
        };

        let shoeData = {};

        // 1. Load Data
        fetch(`${CDN_BASE_URL}/data.json`)
            .then(res => {
                if (!res.ok) throw new Error('Load failed');
                return res.json();
            })
            .then(data => {
                shoeData = data;
                Object.keys(data).forEach(key => addOption(els.brand, key, data[key].name));
            })
            .catch(err => console.error(err));

        // 2. Event Listeners
        els.brand.addEventListener('change', function() {
            const brand = this.value;
            resetSelects(['model', 'color', 'lace']);
            if (brand && shoeData[brand]?.products) {
                Object.keys(shoeData[brand].products).forEach(m => addOption(els.model, m, m.toUpperCase()));
                els.model.disabled = false;
            }
        });

        els.model.addEventListener('change', function() {
            const brand = els.brand.value;
            const model = this.value;
            resetSelects(['color', 'lace']);
            if (brand && model) {
                Object.keys(shoeData[brand].products[model]).forEach(c => addOption(els.color, c, c.toUpperCase()));
                els.color.disabled = false;
            }
        });

        els.color.addEventListener('change', function() {
            const brand = els.brand.value;
            const model = els.model.value;
            const color = this.value;
            resetSelects(['lace']);
            if (brand && model && color) {
                shoeData[brand].products[model][color].forEach(l => addOption(els.lace, l, l.toUpperCase()));
                els.lace.disabled = false;
            }
        });

        els.lace.addEventListener('change', function() {
            if (this.value) loadImage();
        });

        // Utility Functions
        function addOption(el, val, txt) {
            const opt = document.createElement('option');
            opt.value = val;
            opt.text = txt;
            el.appendChild(opt);
        }

        function resetSelects(ids) {
            // ì˜ì–´ ë¼ë²¨ë¡œ ë³€ê²½
            const labels = { 'model': 'Select Model', 'color': 'Shoe Color', 'lace': 'Lace Color' };
            ids.forEach(id => {
                els[id].innerHTML = `<option value="">${labels[id]}</option>`;
                els[id].disabled = true;
            });
            els.img.style.display = 'none';
            els.placeholder.style.display = 'block';
            els.time.innerText = '';
            els.src.innerText = '';
        }

        function loadImage() {
            const { brand, model, color, lace } = els;
            const filename = `${brand.value}_${model.value}_${color.value}_${lace.value}.webp`;
            const fullUrl = `${CDN_BASE_URL}/images/${filename}`;

            const startTime = performance.now();
            
            // Loading status in English
            els.placeholder.style.display = 'none';
            els.time.innerText = 'Loading...';

            els.img.onload = () => {
                const duration = (performance.now() - startTime).toFixed(2);
                els.time.innerText = `âš¡ ${duration} ms`;
                els.src.innerText = fullUrl;
                els.img.style.display = 'block';
            };

            els.img.onerror = () => {
                els.time.innerText = "Image not found";
                els.placeholder.style.display = 'block';
                els.placeholder.innerText = "Preview unavailable";
                els.img.style.display = 'none';
            };

            els.img.src = fullUrl;
        }
    </script>
</body>
</html>