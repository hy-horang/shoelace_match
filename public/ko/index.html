<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹ ë°œëˆ ì¡°í•© ì°¾ê¸° (CDN Test)</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; text-align: center; padding: 50px; }
        select { padding: 10px; margin: 10px; font-size: 16px; }
        #preview-container { margin-top: 30px; min-height: 400px; }
        img { max-width: 500px; border: 1px solid #ddd; border-radius: 10px; }
        .stats { color: red; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ‘Ÿ ì‹ ë°œëˆ ì¡°í•© ì°¾ê¸° (CDN ì„±ëŠ¥ í…ŒìŠ¤íŠ¸)</h1>
    <p>ì›í•˜ëŠ” ì¡°í•©ì„ ì„ íƒí•˜ë©´ CDNì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>

    <div>
        <select id="brand"><option value="">ë¸Œëœë“œ ì„ íƒ</option></select>
        <select id="model" disabled><option value="">ëª¨ë¸ ì„ íƒ</option></select>
        <select id="color" disabled><option value="">ì‹ ë°œ ìƒ‰ìƒ</option></select>
        <select id="lace" disabled><option value="">ì‹ ë°œëˆ ìƒ‰ìƒ</option></select>
    </div>

    <div id="preview-container">
        <p>ì„ íƒ ì™„ë£Œ ì‹œ ì´ë¯¸ì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        <img id="shoeImage" style="display:none;" alt="ì‹ ë°œ ì´ë¯¸ì§€">
        <p id="loadTime" class="stats"></p>
        <p id="currentSrc" style="color:gray; font-size:12px;"></p>
    </div>

    <script>
        const CDN_BASE_URL = ""; 

        const els = {
            brand: document.getElementById('brand'),
            model: document.getElementById('model'),
            color: document.getElementById('color'),
            lace: document.getElementById('lace'),
            img: document.getElementById('shoeImage'),
            time: document.getElementById('loadTime'),
            src: document.getElementById('currentSrc')
        };

        let shoeData = {};

        // 1. JSON ë°ì´í„° ë¡œë“œ
        fetch('/data.json')
            .then(res => res.json())
            .then(data => {
                shoeData = data;
                // ë¸Œëœë“œ ëª©ë¡ ì´ˆê¸°í™”
                Object.keys(data).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.text = data[key].name;
                    els.brand.appendChild(option);
                });
            });

        // 2. ë¸Œëœë“œ ë³€ê²½ ì‹œ -> í•´ë‹¹ ë¸Œëœë“œì˜ ëª¨ë¸ ëª©ë¡ ë¡œë“œ
        els.brand.addEventListener('change', function() {
            const brand = this.value;
            resetSelects(['model', 'color', 'lace']);
            
            if (brand && shoeData[brand].products) {
                // products ê°ì²´ì˜ í‚¤(ëª¨ë¸ëª…)ë“¤ì„ ê°€ì ¸ì˜´
                const models = Object.keys(shoeData[brand].products);
                populateSelect(els.model, models);
                els.model.disabled = false;
            }
        });

        // 3. ëª¨ë¸ ë³€ê²½ ì‹œ -> í•´ë‹¹ ëª¨ë¸ì˜ ì‹ ë°œ ìƒ‰ìƒ ëª©ë¡ ë¡œë“œ
        els.model.addEventListener('change', function() {
            const brand = els.brand.value;
            const model = this.value;
            resetSelects(['color', 'lace']);
            
            if (brand && model) {
                // ì„ íƒí•œ ëª¨ë¸ í•˜ìœ„ì˜ í‚¤(ìƒ‰ìƒ)ë“¤ì„ ê°€ì ¸ì˜´
                const colors = Object.keys(shoeData[brand].products[model]);
                populateSelect(els.color, colors);
                els.color.disabled = false;
            }
        });

        // 4. ìƒ‰ìƒ ë³€ê²½ ì‹œ -> í•´ë‹¹ ìƒ‰ìƒ ì‹ ë°œì˜ ëˆ(Lace) ëª©ë¡ ë¡œë“œ
        els.color.addEventListener('change', function() {
            const brand = els.brand.value;
            const model = els.model.value;
            const color = this.value;
            resetSelects(['lace']);
            
            if (brand && model && color) {
                // í•´ë‹¹ ìƒ‰ìƒì— ì •ì˜ëœ ëˆ ë°°ì—´ì„ ê°€ì ¸ì˜´
                const laces = shoeData[brand].products[model][color];
                populateSelect(els.lace, laces);
                els.lace.disabled = false;
            }
        });

        // 5. ëˆ ìƒ‰ìƒ ë³€ê²½ (ìµœì¢… ì„ íƒ) -> ì´ë¯¸ì§€ ë¡œë“œ
        els.lace.addEventListener('change', function() {
            if (this.value) {
                loadImage();
            }
        });

        function populateSelect(element, items) {
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.text = item.toUpperCase();
                element.appendChild(option);
            });
        }

        function resetSelects(ids) {
            ids.forEach(id => {
                const el = els[id];
                el.innerHTML = '<option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>';
                el.disabled = true;
            });
            els.img.style.display = 'none';
            els.time.innerText = '';
            els.src.innerText = '';
        }

        function loadImage() {
            const brand = els.brand.value;
            const model = els.model.value;
            const color = els.color.value;
            const lace = els.lace.value;

            // ì´ë¯¸ì§€ê°€ í™•ì‹¤íˆ ì¡´ì¬í•˜ëŠ” ì¡°í•©ë§Œ ì„ íƒë˜ì—ˆìœ¼ë¯€ë¡œ 404 ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ
            const filename = `${brand}_${model}_${color}_${lace}.webp`;
            const fullUrl = `${CDN_BASE_URL}/images/${filename}`;

            const startTime = performance.now();

            els.img.src = fullUrl;
            els.img.style.display = 'block';
            els.src.innerText = `ìš”ì²­ URL: ${fullUrl}`;

            els.img.onload = () => {
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);
                els.time.innerText = `â± ë¡œë”© ì‹œê°„: ${duration} ms`;
            };

            els.img.onerror = () => {
                els.time.innerText = "âŒ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                els.img.style.display = 'none';
            };
        }
    </script>
</body>
</html>